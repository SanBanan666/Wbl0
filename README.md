# ๐ Order Service - ะะธะบัะพัะตัะฒะธั ะพะฑัะฐะฑะพัะบะธ ะทะฐะบะฐะทะพะฒ

ะะตะผะพะฝัััะฐัะธะพะฝะฝัะน ะผะธะบัะพัะตัะฒะธั ะฝะฐ Go ะดะปั ะพะฑัะฐะฑะพัะบะธ ะทะฐะบะฐะทะพะฒ ะธะท Kafka, ัะพััะฐะฝะตะฝะธั ะฒ PostgreSQL, ะบะตัะธัะพะฒะฐะฝะธั ะฒ ะฟะฐะผััะธ ะธ ะฟัะตะดะพััะฐะฒะปะตะฝะธั HTTP API ั ะฒะตะฑ-ะธะฝัะตััะตะนัะพะผ.

## ๐ ะกะพะดะตัะถะฐะฝะธะต

- [ะััะธัะตะบัััะฐ](#ะฐััะธัะตะบัััะฐ)
- [ะขะตัะฝะพะปะพะณะธะธ](#ัะตัะฝะพะปะพะณะธะธ)
- [ะกัััะบัััะฐ ะฟัะพะตะบัะฐ](#ััััะบัััะฐ-ะฟัะพะตะบัะฐ)
- [ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ](#ัััะฐะฝะพะฒะบะฐ-ะธ-ะทะฐะฟััะบ)
- [ะัะฟะพะปัะทะพะฒะฐะฝะธะต](#ะธัะฟะพะปัะทะพะฒะฐะฝะธะต)
- [API ะดะพะบัะผะตะฝัะฐัะธั](#api-ะดะพะบัะผะตะฝัะฐัะธั)
- [ะะฐะทัะฐะฑะพัะบะฐ](#ัะฐะทัะฐะฑะพัะบะฐ)
- [ะะพะฝะธัะพัะธะฝะณ](#ะผะพะฝะธัะพัะธะฝะณ)

## ๐๏ธ ะััะธัะตะบัััะฐ

ะัะพะตะบั ัะตะฐะปะธะทัะตั ะผะธะบัะพัะตัะฒะธัะฝัั ะฐััะธัะตะบัััั ั ัะปะตะดัััะธะผะธ ะบะพะผะฟะพะฝะตะฝัะฐะผะธ:

```
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
โ   Frontend  โ    โ   Kafka UI  โ    โ   Script    โ
โ  (Nginx)    โ    โ  (Port 8080)โ    โ  Producer   โ
โ (Port 8082) โ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโ           โ                   โ
         โ                โ                   โ
         โผ                โผ                   โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Order Service                        โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ     โ
โ  โ   HTTP API  โ  โ   Kafka     โ  โ   Cache     โ     โ
โ  โ (Port 8081) โ  โ Consumer    โ  โ (In-Memory) โ     โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ                โ                   โ
         โผ                โผ                   โผ
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
โ PostgreSQL  โ    โ   Kafka     โ    โ  Zookeeper  โ
โ (Port 5432) โ    โ (Port 9092) โ    โ (Port 2181) โ
โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
```

### ะะพะผะฟะพะฝะตะฝัั ัะธััะตะผั:

1. **Order Service (Go)** - ะพัะฝะพะฒะฝะพะน ะผะธะบัะพัะตัะฒะธั
   - HTTP API ะดะปั ะฟะพะปััะตะฝะธั ะทะฐะบะฐะทะพะฒ
   - Kafka Consumer ะดะปั ะพะฑัะฐะฑะพัะบะธ ัะพะพะฑัะตะฝะธะน
   - In-Memory ะบะตั ะดะปั ััะบะพัะตะฝะธั ะทะฐะฟัะพัะพะฒ
   - PostgreSQL ัะตะฟะพะทะธัะพัะธะน ะดะปั ััะฐะฝะตะฝะธั ะดะฐะฝะฝัั

2. **PostgreSQL** - ะพัะฝะพะฒะฝะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั
   - ะฅัะฐะฝะตะฝะธะต ะทะฐะบะฐะทะพะฒ, ะดะพััะฐะฒะบะธ, ะฟะปะฐัะตะถะตะน ะธ ัะพะฒะฐัะพะฒ
   - ะะฒัะพะผะฐัะธัะตัะบะธะต ะผะธะณัะฐัะธะธ ะฟัะธ ะทะฐะฟััะบะต

3. **Kafka + Zookeeper** - ะฑัะพะบะตั ัะพะพะฑัะตะฝะธะน
   - ะัะธะฝััะพะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะทะฐะบะฐะทะพะฒ
   - ะะฐัััะฐะฑะธััะตะผะพััั ะธ ะพัะบะฐะทะพัััะพะนัะธะฒะพััั

4. **Nginx** - ะฒะตะฑ-ัะตัะฒะตั ะดะปั ััะพะฝัะตะฝะดะฐ
   - ะกัะฐัะธัะตัะบะฐั ัะฐะทะดะฐัะฐ HTML/CSS/JS
   - ะัะพะบัะธัะพะฒะฐะฝะธะต API ะทะฐะฟัะพัะพะฒ

5. **Kafka UI** - ะฒะตะฑ-ะธะฝัะตััะตะนั ะดะปั ัะฟัะฐะฒะปะตะฝะธั Kafka
   - ะัะพัะผะพัั ัะพะฟะธะบะพะฒ ะธ ัะพะพะฑัะตะฝะธะน
   - ะะพะฝะธัะพัะธะฝะณ ัะพััะพัะฝะธั ะฑัะพะบะตัะฐ

## ๐๏ธ ะขะตัะฝะพะปะพะณะธะธ

### Backend
- **Go 1.23** - ะพัะฝะพะฒะฝะพะน ัะทัะบ ัะฐะทัะฐะฑะพัะบะธ
- **PostgreSQL 15** - ัะตะปััะธะพะฝะฝะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั
- **Apache Kafka 7.4** - ะฑัะพะบะตั ัะพะพะฑัะตะฝะธะน
- **Sarama** - Go ะบะปะธะตะฝั ะดะปั Kafka
- **lib/pq** - ะดัะฐะนะฒะตั PostgreSQL

### Frontend
- **HTML5/CSS3** - ัะพะฒัะตะผะตะฝะฝัะน ะฒะตะฑ-ะธะฝัะตััะตะนั
- **Vanilla JavaScript** - ะธะฝัะตัะฐะบัะธะฒะฝะพััั
- **Nginx** - ะฒะตะฑ-ัะตัะฒะตั

### Infrastructure
- **Docker & Docker Compose** - ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั
- **Alpine Linux** - ะปะตะณะบะพะฒะตัะฝัะต ะพะฑัะฐะทั

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
wildL0/
โโโ Wbl0/                          # ะัะฝะพะฒะฝะพะน ะบะพะด Go
โ   โโโ cmd/
โ   โ   โโโ api/                   # HTTP API ัะตัะฒะตั
โ   โ   โ   โโโ main.go           # ะขะพัะบะฐ ะฒัะพะดะฐ
โ   โ   โ   โโโ Dockerfile        # ะะฑัะฐะท ะดะปั API
โ   โ   โโโ migr/                 # ะะธะณัะฐัะธะธ ะะ
โ   โ       โโโ main.go
โ   โ       โโโ Dockerfile
โ   โโโ internal/
โ   โ   โโโ application/          # ะกะปะพะน ะฟัะธะปะพะถะตะฝะธั
โ   โ   โ   โโโ dto/             # Data Transfer Objects
โ   โ   โ   โโโ handlers/        # ะะฑัะฐะฑะพััะธะบะธ ัะพะพะฑัะตะฝะธะน
โ   โ   โ   โโโ interfaces/      # ะะฝัะตััะตะนัั
โ   โ   โ   โโโ services/        # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   โ   โโโ domain/              # ะะพะผะตะฝะฝะฐั ะผะพะดะตะปั
โ   โ   โ   โโโ entities/        # ะกััะฝะพััะธ
โ   โ   โโโ infrastructure/      # ะะฝััะฐััััะบัััะฝัะน ัะปะพะน
โ   โ   โ   โโโ consumers/       # Kafka ะฟะพััะตะฑะธัะตะปะธ
โ   โ   โ   โโโ migrations/      # ะะธะณัะฐัะธะธ ะะ
โ   โ   โ   โโโ repositories/    # ะะตะฟะพะทะธัะพัะธะธ
โ   โ   โโโ presentation/        # ะกะปะพะน ะฟัะตะดััะฐะฒะปะตะฝะธั
โ   โ       โโโ controllers/     # HTTP ะบะพะฝััะพะปะปะตัั
โ   โโโ pkg/                     # ะะฑัะธะต ะฟะฐะบะตัั
โ   โ   โโโ dbconnections/       # ะะพะดะบะปััะตะฝะธั ะบ ะะ
โ   โ   โโโ logger/              # ะะพะณะธัะพะฒะฐะฝะธะต
โ   โโโ db/
โ       โโโ migrations/          # SQL ะผะธะณัะฐัะธะธ
โโโ frontend/                     # ะะตะฑ-ะธะฝัะตััะตะนั
โ   โโโ index.html               # ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ
โโโ scripts/                      # ะกะบัะธะฟัั
โ   โโโ send_test_order.go       # ะขะตััะพะฒัะน producer
โโโ docker-compose.yml           # ะะพะฝัะธะณััะฐัะธั Docker
โโโ nginx.conf                   # ะะพะฝัะธะณััะฐัะธั Nginx
โโโ go.mod                       # Go ะผะพะดัะปะธ
โโโ go.sum                       # Go ะทะฐะฒะธัะธะผะพััะธ
โโโ README.md                    # ะะพะบัะผะตะฝัะฐัะธั
```

## ๐ ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ

### ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั

- Docker Desktop
- Go 1.23+ (ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ)
- Git

### ะัััััะน ะทะฐะฟััะบ

1**ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ:**
```bash
docker-compose up -d
```

2**ะัะพะฒะตัะบะฐ ััะฐัััะฐ:**
```bash
docker-compose ps
```

3**ะัะฟัะฐะฒะบะฐ ัะตััะพะฒัั ะดะฐะฝะฝัั:**
```bash
go run scripts/send_test_order.go
```

### ะะพัััะฟะฝัะต ัะตัะฒะธัั

ะะพัะปะต ะทะฐะฟััะบะฐ ะฑัะดัั ะดะพัััะฟะฝั ัะปะตะดัััะธะต ัะตัะฒะธัั:

| ะกะตัะฒะธั | URL | ะะฟะธัะฐะฝะธะต |
|--------|-----|----------|
| Frontend | http://localhost:8082 | ะะตะฑ-ะธะฝัะตััะตะนั ะฟะพะธัะบะฐ ะทะฐะบะฐะทะพะฒ |
| API | http://localhost:8081 | HTTP API ะดะปั ะทะฐะบะฐะทะพะฒ |
| Kafka UI | http://localhost:8080 | ะฃะฟัะฐะฒะปะตะฝะธะต Kafka |
| PostgreSQL | localhost:5432 | ะะฐะทะฐ ะดะฐะฝะฝัั |
| Kafka | localhost:9092 | ะัะพะบะตั ัะพะพะฑัะตะฝะธะน |

## ๐ ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### ะะตะฑ-ะธะฝัะตััะตะนั

1. ะัะบัะพะนัะต http://localhost:8082
2. ะะฒะตะดะธัะต ID ะทะฐะบะฐะทะฐ ะฒ ะฟะพะปะต ะฟะพะธัะบะฐ
3. ะะฐะถะผะธัะต "ะะฐะนัะธ ะทะฐะบะฐะท"
4. ะัะพัะผะพััะธัะต ะดะตัะฐะปัะฝัั ะธะฝัะพัะผะฐัะธั ะพ ะทะฐะบะฐะทะต

### HTTP API

#### ะะพะปััะตะฝะธะต ะทะฐะบะฐะทะฐ ะฟะพ ID
```bash
GET http://localhost:8081/order/{order_uid}
```

**ะัะธะผะตั ะทะฐะฟัะพัะฐ:**
```bash
curl http://localhost:8081/order/b563feb7b2b84b6test
```

**ะัะธะผะตั ะพัะฒะตัะฐ:**
```json
{
  "order": {
    "order_uid": "b563feb7b2b84b6test",
    "track_number": "WBILMTESTTRACK",
    "entry": "WBIL",
    "delivery": {
      "name": "Test Testov",
      "phone": "+9720000000",
      "zip": "2639809",
      "city": "Kiryat Mozkin",
      "address": "Ploshad Mira 15",
      "region": "Kraiot",
      "email": "test@gmail.com"
    },
    "payment": {
      "transaction": "b563feb7b2b84b6test",
      "request_id": "",
      "currency": "USD",
      "provider": "wbpay",
      "amount": 1817,
      "payment_dt": 1637907727,
      "bank": "alpha",
      "delivery_cost": 1500,
      "goods_total": 317,
      "custom_fee": 0
    },
    "items": [
      {
        "chrt_id": 9934930,
        "track_number": "WBILMTESTTRACK",
        "price": 453,
        "rid": "ab4219087a764ae0btest",
        "name": "Mascaras",
        "sale": 30,
        "size": "0",
        "total_price": 317,
        "nm_id": 2389212,
        "brand": "Vivienne Sabo",
        "status": 202
      }
    ],
    "locale": "en",
    "internal_signature": "",
    "customer_id": "test",
    "delivery_service": "meest",
    "shardkey": "9",
    "sm_id": 99,
    "date_created": "2021-11-26T06:22:19Z",
    "oof_shard": "1"
  }
}
```

#### ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั ัะตัะฒะธัะฐ
```bash
GET http://localhost:8081/health
```

### ะัะฟัะฐะฒะบะฐ ัะตััะพะฒัั ะทะฐะบะฐะทะพะฒ

```bash
go run scripts/send_test_order.go
```

ะญัะพั ัะบัะธะฟั ะพัะฟัะฐะฒะปัะตั 3 ัะตััะพะฒัั ะทะฐะบะฐะทะฐ ะฒ Kafka:
- `b563feb7b2b84b6test`
- `test-order-1`
- `test-order-2`

## ๐ง API ะดะพะบัะผะตะฝัะฐัะธั

### Endpoints

| ะะตัะพะด | ะััั | ะะฟะธัะฐะฝะธะต |
|-------|------|----------|
| GET | `/order/{order_uid}` | ะะพะปััะธัั ะทะฐะบะฐะท ะฟะพ ID |
| GET | `/health` | ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั ัะตัะฒะธัะฐ |

### ะะพะดั ะพัะฒะตัะพะฒ

| ะะพะด | ะะฟะธัะฐะฝะธะต |
|-----|----------|
| 200 | ะฃัะฟะตัะฝัะน ะทะฐะฟัะพั |
| 404 | ะะฐะบะฐะท ะฝะต ะฝะฐะนะดะตะฝ |
| 500 | ะะฝัััะตะฝะฝัั ะพัะธะฑะบะฐ ัะตัะฒะตัะฐ |

### CORS

API ะฟะพะดะดะตัะถะธะฒะฐะตั CORS ะดะปั ะฒะตะฑ-ะฟัะธะปะพะถะตะฝะธะน:
- `Access-Control-Allow-Origin: *`
- `Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS`
- `Access-Control-Allow-Headers: Content-Type, Authorization`

## ๐ป ะะฐะทัะฐะฑะพัะบะฐ

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

1. **ะะฐะฟััะบ ะทะฐะฒะธัะธะผะพััะตะน:**
```bash
docker-compose up -d postgres kafka zookeeper
```

2. **ะะฐัััะพะนะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั:**
```bash
export DB_HOST=localhost
export DB_PORT=5432
export DB_USER=postgres
export DB_PASSWORD=postgres
export DB_NAME=orders_db
export DB_SSLMODE=disable
export KAFKA_BROKERS=localhost:9092
export KAFKA_TOPIC=orders
export KAFKA_GROUP_ID=order-service-group
export HTTP_PORT=8081
```

3. **ะะฐะฟััะบ ัะตัะฒะธัะฐ:**
```bash
go run Wbl0/cmd/api/main.go
```

### ะกัััะบัััะฐ ะบะพะดะฐ

ะัะพะตะบั ัะปะตะดัะตั ะฟัะธะฝัะธะฟะฐะผ Clean Architecture:

- **Domain Layer** - ะฑะธะทะฝะตั-ัััะฝะพััะธ ะธ ะฟัะฐะฒะธะปะฐ
- **Application Layer** - ะฑะธะทะฝะตั-ะปะพะณะธะบะฐ ะธ ัะตัะฒะธัั
- **Infrastructure Layer** - ะฒะฝะตัะฝะธะต ะทะฐะฒะธัะธะผะพััะธ (ะะ, Kafka)
- **Presentation Layer** - HTTP ะบะพะฝััะพะปะปะตัั

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ััะฝะบัะธะน

1. **ะะพะฒัะน endpoint:**
   - ะะพะฑะฐะฒะธัั ะผะตัะพะด ะฒ ะบะพะฝััะพะปะปะตั
   - ะะฐัะตะณะธัััะธัะพะฒะฐัั ะผะฐััััั ะฒ main.go

2. **ะะพะฒะฐั ะฑะธะทะฝะตั-ะปะพะณะธะบะฐ:**
   - ะกะพะทะดะฐัั ัะตัะฒะธั ะฒ application/services
   - ะะฟัะตะดะตะปะธัั ะธะฝัะตััะตะนั ะฒ application/interfaces

3. **ะะพะฒัะต ะดะฐะฝะฝัะต:**
   - ะะพะฑะฐะฒะธัั ะผะธะณัะฐัะธั ะฒ db/migrations
   - ะะฑะฝะพะฒะธัั ัััะฝะพััะธ ะฒ domain/entities

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะะพะณะธ

ะัะพัะผะพัั ะปะพะณะพะฒ ัะตัะฒะธัะพะฒ:

```bash
# ะะพะณะธ Order Service
docker logs order-service-app

# ะะพะณะธ PostgreSQL
docker logs order-service-postgres

# ะะพะณะธ Kafka
docker logs order-service-kafka
```

### Kafka UI

ะัะบัะพะนัะต http://localhost:8080 ะดะปั:
- ะัะพัะผะพััะฐ ัะพะฟะธะบะพะฒ
- ะะพะฝะธัะพัะธะฝะณะฐ ัะพะพะฑัะตะฝะธะน
- ะัะพะฒะตัะบะธ ัะพััะพัะฝะธั consumer ะณััะฟะฟ

### ะะตััะธะบะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

- **ะะตั-ัะธัั:** ะะพะณะธ ะฟะพะบะฐะทัะฒะฐัั `Order found in cache`
- **ะัะตะผั ะพัะฒะตัะฐ API:** ะะทะผะตััะตััั ัะตัะตะท curl
- **ะะฑัะฐะฑะพัะบะฐ Kafka:** ะะพะณะธ `Received message` ะธ `processed successfully`

## ๐ ะฃัััะฐะฝะตะฝะธะต ะฝะตะฟะพะปะฐะดะพะบ

### ะงะฐัััะต ะฟัะพะฑะปะตะผั

1. **ะะพัั 80 ะทะฐะฝัั Apache2:**
   - ะััะฐะฝะพะฒะธัะต Apache2: `sudo systemctl stop apache2`
   - ะะปะธ ะธะทะผะตะฝะธัะต ะฟะพัั Nginx ะฒ docker-compose.yml

2. **ะัะธะฑะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบ ะะ:**
   - ะัะพะฒะตัััะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
   - ะฃะฑะตะดะธัะตัั, ััะพ PostgreSQL ะทะฐะฟััะตะฝ

3. **Kafka ะฝะต ะฟะพะดะบะปััะฐะตััั:**
   - ะัะพะฒะตัััะต, ััะพ Zookeeper ะทะฐะฟััะตะฝ
   - ะฃะฑะตะดะธัะตัั ะฒ ะฟัะฐะฒะธะปัะฝะพััะธ ะฐะดัะตัะพะฒ ะฑัะพะบะตัะพะฒ

4. **CORS ะพัะธะฑะบะธ:**
   - ะัะพะฒะตัััะต, ััะพ CORS middleware ะดะพะฑะฐะฒะปะตะฝ
   - ะฃะฑะตะดะธัะตัั ะฒ ะฟัะฐะฒะธะปัะฝะพััะธ ะทะฐะณะพะปะพะฒะบะพะฒ

### ะะพะผะฐะฝะดั ะดะธะฐะณะฝะพััะธะบะธ

```bash
# ะัะพะฒะตัะบะฐ ััะฐัััะฐ ะบะพะฝัะตะนะฝะตัะพะฒ
docker-compose ps

# ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ
docker-compose logs

# ะะตัะตะทะฐะฟััะบ ัะตัะฒะธัะฐ
docker-compose restart order-service

# ะะพะปะฝะฐั ะฟะตัะตัะฑะพัะบะฐ
docker-compose down -v
docker-compose up -d --build
```

## ๐ ะะธัะตะฝะทะธั

ะญัะพั ะฟัะพะตะบั ัะพะทะดะฐะฝ ะฒ ะดะตะผะพะฝัััะฐัะธะพะฝะฝัั ัะตะปัั.

## ๐ค ะะบะปะฐะด ะฒ ะฟัะพะตะบั

1. Fork ัะตะฟะพะทะธัะพัะธั
2. ะกะพะทะดะฐะนัะต feature branch
3. ะะฝะตัะธัะต ะธะทะผะตะฝะตะฝะธั
4. ะะพะฑะฐะฒััะต ัะตััั
5. ะกะพะทะดะฐะนัะต Pull Request# 
Wbl0